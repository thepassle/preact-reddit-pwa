{"version":3,"file":"index.js","sources":["../dist-src/index.js"],"sourcesContent":["import fs from 'fs';\nimport path from 'path';\nimport rimraf from 'rimraf';\nimport mkdirp from 'mkdirp';\nimport chalk from 'chalk';\nimport glob from 'glob';\nimport ora from 'ora';\nimport yargs from 'yargs-parser';\nimport resolveFrom from 'resolve-from';\nimport * as rollup from 'rollup';\nimport rollupPluginNodeResolve from 'rollup-plugin-node-resolve';\nimport rollupPluginCommonjs from 'rollup-plugin-commonjs';\nimport { terser as rollupPluginTerser } from 'rollup-plugin-terser';\nimport rollupPluginReplace from 'rollup-plugin-replace';\nimport rollupPluginJson from 'rollup-plugin-json';\nimport rollupPluginBabel from 'rollup-plugin-babel';\nimport babelPresetEnv from '@babel/preset-env';\nimport isNodeBuiltin from 'is-builtin-module';\n// Having trouble getting this ES2019 feature to compile, so using this ponyfill for now.\nfunction fromEntries(iterable) {\n    return [...iterable].reduce((obj, { 0: key, 1: val }) => Object.assign(obj, { [key]: val }), {});\n}\nconst cwd = process.cwd();\nconst banner = chalk.bold(`@pika/web`) + ` installing... `;\nconst detectionResults = [];\nlet spinner = ora(banner);\nlet spinnerHasError = false;\nfunction printHelp() {\n    console.log(`\n${chalk.bold(`@pika/web`)} - Install npm dependencies to run natively on the web.\n${chalk.bold('Options:')}\n    --dest              Specify destination directory (default: \"web_modules/\").\n    --clean             Clear out the destination directory before install.\n    --optimize          Transpile, minify, and optimize installed dependencies for production.\n    --babel             Transpile installed dependencies. Also enabled with \"--optimize\".\n    --strict            Only install pure ESM dependency trees. Fail if a CJS module is encountered.\n    --no-source-map     Skip emitting source map files (.js.map) into dest\n${chalk.bold('Advanced:')}\n    --remote-package    \"name,version\" pair(s) of packages that should be left unbundled and referenced remotely.\n                        Example: \"foo,v4\" will rewrite all imports of \"foo\" to \"{remoteUrl}/foo/v4\" (see --remote-url).\n    --remote-url        Configures the domain where remote imports point to (default: \"https://cdn.pika.dev\")\n    `.trim());\n}\nfunction formatDetectionResults(skipFailures) {\n    return detectionResults\n        .map(([d, yn]) => (yn ? chalk.green(d) : skipFailures ? chalk.dim(d) : chalk.red(d)))\n        .join(', ');\n}\nfunction logError(msg) {\n    if (!spinnerHasError) {\n        spinner.stopAndPersist({ symbol: chalk.cyan('â ¼') });\n    }\n    spinnerHasError = true;\n    spinner = ora(chalk.red(msg));\n    spinner.fail();\n}\nclass ErrorWithHint extends Error {\n    constructor(message, hint) {\n        super(message);\n        this.hint = hint;\n    }\n}\n// Add common, well-used non-esm packages here so that Rollup doesn't die trying to analyze them.\nconst PACKAGES_TO_AUTO_DETECT_EXPORTS = [\n    path.join('react', 'index.js'),\n    path.join('react-dom', 'index.js'),\n    path.join('react-is', 'index.js'),\n    path.join('prop-types', 'index.js'),\n    path.join('rxjs', 'Rx.js'),\n];\nfunction detectExports(filePath) {\n    try {\n        const fileLoc = resolveFrom(cwd, filePath);\n        if (fs.existsSync(fileLoc)) {\n            return Object.keys(require(fileLoc)).filter(e => e[0] !== '_');\n        }\n    }\n    catch (err) {\n        // ignore\n    }\n}\n/**\n * Resolve a \"webDependencies\" input value to the correct absolute file location.\n * Supports both npm package names, and file paths relative to the node_modules directory.\n * Follows logic similar to Node's resolution logic, but using a package.json's ESM \"module\"\n * field instead of the CJS \"main\" field.\n */\nfunction resolveWebDependency(dep, isExplicit) {\n    // if the path includes a file extension, just use it\n    if (path.extname(dep)) {\n        const isJSFile = ['.js', '.mjs', '.cjs'].includes(path.extname(dep));\n        return {\n            type: isJSFile ? 'JS' : 'ASSET',\n            loc: resolveFrom(cwd, dep),\n        };\n    }\n    const depManifestLoc = resolveFrom(cwd, `${dep}/package.json`);\n    const depManifest = require(depManifestLoc);\n    let foundEntrypoint = depManifest.module;\n    // If the package was a part of the explicit whitelist, fallback to it's main CJS entrypoint.\n    if (!foundEntrypoint && isExplicit) {\n        foundEntrypoint = depManifest.main || 'index.js';\n    }\n    if (!foundEntrypoint) {\n        throw new ErrorWithHint(`dependency \"${dep}\" has no native \"module\" entrypoint.`, chalk.italic(`Tip: Find modern, web-ready packages at ${chalk.underline('https://www.pika.dev')}`));\n    }\n    if (dep === 'react' && foundEntrypoint === 'index.js') {\n        throw new ErrorWithHint(`dependency \"react\" has no native \"module\" entrypoint.`, chalk.italic(`See: ${chalk.underline('https://github.com/pikapkg/web#a-note-on-react')}`));\n    }\n    return {\n        type: 'JS',\n        loc: path.join(depManifestLoc, '..', foundEntrypoint),\n    };\n}\n/**\n * Formats the @pika/web dependency name from a \"webDependencies\" input value:\n * 2. Remove any \".js\" extension (will be added automatically by Rollup)\n */\nfunction getWebDependencyName(dep) {\n    return dep.replace(/\\.js$/, '');\n}\nexport async function install(arrayOfDeps, { isCleanInstall, destLoc, hasBrowserlistConfig, isExplicit, isStrict, isBabel, isOptimized, sourceMap, namedExports, remoteUrl, remotePackages, }) {\n    const nodeModulesLoc = path.join(cwd, 'node_modules');\n    const knownNamedExports = { ...namedExports };\n    const remotePackageMap = fromEntries(remotePackages);\n    const depList = new Set();\n    arrayOfDeps.forEach(dep => {\n        if (!glob.hasMagic(dep)) {\n            depList.add(dep);\n        }\n        else {\n            glob.sync(dep, { cwd: nodeModulesLoc, nodir: true }).forEach(f => depList.add(f));\n        }\n    });\n    for (const filePath of PACKAGES_TO_AUTO_DETECT_EXPORTS) {\n        knownNamedExports[filePath] = knownNamedExports[filePath] || detectExports(filePath) || [];\n    }\n    if (depList.size === 0) {\n        logError('no dependencies found.');\n        return;\n    }\n    if (!fs.existsSync(path.join(cwd, 'node_modules'))) {\n        logError('no \"node_modules\" directory exists. Did you run \"npm install\" first?');\n        return;\n    }\n    if (isCleanInstall) {\n        rimraf.sync(destLoc);\n    }\n    const depObject = {};\n    const assetObject = {};\n    const importMap = {};\n    const skipFailures = !isExplicit;\n    for (const dep of depList) {\n        try {\n            const depName = getWebDependencyName(dep);\n            const { type: depType, loc: depLoc } = resolveWebDependency(dep, isExplicit);\n            if (depType === 'JS') {\n                depObject[depName] = depLoc;\n                importMap[depName] = `./${depName}.js`;\n                detectionResults.push([dep, true]);\n            }\n            if (depType === 'ASSET') {\n                assetObject[depName] = depLoc;\n                detectionResults.push([dep, true]);\n            }\n            spinner.text = banner + formatDetectionResults(skipFailures);\n        }\n        catch (err) {\n            detectionResults.push([dep, false]);\n            spinner.text = banner + formatDetectionResults(skipFailures);\n            if (skipFailures) {\n                continue;\n            }\n            // An error occurred! Log it.\n            logError(err.message || err);\n            if (err.hint) {\n                console.log(err.hint);\n            }\n            return false;\n        }\n    }\n    if (Object.keys(depObject).length === 0 && Object.keys(assetObject).length === 0) {\n        logError(`No ESM dependencies found!`);\n        console.log(chalk.dim(`  At least one dependency must have an ESM \"module\" entrypoint. You can find modern, web-ready packages at ${chalk.underline('https://www.pika.dev')}`));\n        return false;\n    }\n    if (Object.keys(depObject).length > 0) {\n        const inputOptions = {\n            input: depObject,\n            plugins: [\n                !isStrict &&\n                    rollupPluginReplace({\n                        'process.env.NODE_ENV': isOptimized ? '\"production\"' : '\"development\"',\n                    }),\n                remotePackages.length > 0 && {\n                    name: 'pika:peer-dependency-resolver',\n                    resolveId(source) {\n                        if (remotePackageMap[source]) {\n                            let urlSourcePath = source;\n                            // NOTE(@fks): This is really Pika CDN specific, but no one else should be using this option.\n                            if (source === 'react' || source === 'react-dom') {\n                                urlSourcePath = '_/' + source;\n                            }\n                            return {\n                                id: `${remoteUrl}/${urlSourcePath}/${remotePackageMap[source]}`,\n                                external: true,\n                                isExternal: true,\n                            };\n                        }\n                        return null;\n                    },\n                    load(id) {\n                        return null;\n                    },\n                },\n                rollupPluginNodeResolve({\n                    mainFields: ['browser', 'module', !isStrict && 'main'].filter(Boolean),\n                    modulesOnly: isStrict,\n                    extensions: ['.mjs', '.cjs', '.js', '.json'],\n                    // whether to prefer built-in modules (e.g. `fs`, `path`) or local ones with the same names\n                    preferBuiltins: false,\n                }),\n                !isStrict &&\n                    rollupPluginJson({\n                        preferConst: true,\n                        indent: '  ',\n                    }),\n                !isStrict &&\n                    rollupPluginCommonjs({\n                        extensions: ['.js', '.cjs'],\n                        namedExports: knownNamedExports,\n                    }),\n                !!isBabel &&\n                    rollupPluginBabel({\n                        compact: false,\n                        babelrc: false,\n                        presets: [\n                            [\n                                babelPresetEnv,\n                                {\n                                    modules: false,\n                                    targets: hasBrowserlistConfig ? undefined : '>0.75%, not ie 11, not op_mini all',\n                                },\n                            ],\n                        ],\n                    }),\n                !!isOptimized && rollupPluginTerser(),\n            ],\n            onwarn: ((warning, warn) => {\n                if (warning.code === 'UNRESOLVED_IMPORT') {\n                    logError(`'${warning.source}' is imported by '${warning.importer}', but could not be resolved.`);\n                    if (isNodeBuiltin(warning.source)) {\n                        console.log(chalk.dim(`  '${warning.source}' is a Node.js builtin module that won't exist on the web. You can find modern, web-ready packages at ${chalk.underline('https://www.pika.dev')}`));\n                    }\n                    else {\n                        console.log(chalk.dim(`  Make sure that the package is installed and that the file exists.`));\n                    }\n                    return;\n                }\n                warn(warning);\n            }),\n        };\n        const outputOptions = {\n            dir: destLoc,\n            format: 'esm',\n            sourcemap: sourceMap === undefined ? isOptimized : sourceMap,\n            exports: 'named',\n            chunkFileNames: 'common/[name]-[hash].js',\n        };\n        const packageBundle = await rollup.rollup(inputOptions);\n        await packageBundle.write(outputOptions);\n        fs.writeFileSync(path.join(destLoc, 'import-map.json'), JSON.stringify({ imports: importMap }, undefined, 2), { encoding: 'utf8' });\n    }\n    Object.entries(assetObject).forEach(([assetName, assetLoc]) => {\n        mkdirp.sync(path.dirname(`${destLoc}/${assetName}`));\n        fs.copyFileSync(assetLoc, `${destLoc}/${assetName}`);\n    });\n    return true;\n}\nexport async function cli(args) {\n    const { help, sourceMap, babel = false, optimize = false, strict = false, clean = false, dest = 'web_modules', remoteUrl = 'https://cdn.pika.dev', remotePackage: remotePackages = [], } = yargs(args);\n    const destLoc = path.resolve(cwd, dest);\n    if (help) {\n        printHelp();\n        process.exit(0);\n    }\n    const pkgManifest = require(path.join(cwd, 'package.json'));\n    const { namedExports, webDependencies } = pkgManifest['@pika/web'] || {\n        namedExports: undefined,\n        webDependencies: undefined,\n    };\n    const doesWhitelistExist = !!webDependencies;\n    const arrayOfDeps = webDependencies || Object.keys(pkgManifest.dependencies || {});\n    const hasBrowserlistConfig = !!pkgManifest.browserslist ||\n        !!process.env.BROWSERSLIST ||\n        fs.existsSync(path.join(cwd, '.browserslistrc')) ||\n        fs.existsSync(path.join(cwd, 'browserslist'));\n    spinner.start();\n    const startTime = Date.now();\n    const result = await install(arrayOfDeps, {\n        isCleanInstall: clean,\n        destLoc,\n        namedExports,\n        isExplicit: doesWhitelistExist,\n        isStrict: strict,\n        isBabel: babel || optimize,\n        isOptimized: optimize,\n        sourceMap,\n        remoteUrl,\n        hasBrowserlistConfig,\n        remotePackages: remotePackages.map(p => p.split(',')),\n    });\n    if (result) {\n        spinner.succeed(chalk.bold(`@pika/web`) +\n            ` installed: ` +\n            formatDetectionResults(!doesWhitelistExist) +\n            '. ' +\n            chalk.dim(`[${((Date.now() - startTime) / 1000).toFixed(2)}s]`));\n    }\n    if (spinnerHasError) {\n        // Set the exit code so that programmatic usage of the CLI knows that there were errors.\n        spinner.warn(chalk(`Finished with warnings.`));\n        process.exitCode = 1;\n    }\n}\n"],"names":["fromEntries","iterable","reduce","obj","key","val","Object","assign","cwd","process","banner","chalk","bold","detectionResults","spinner","ora","spinnerHasError","printHelp","console","log","trim","formatDetectionResults","skipFailures","map","d","yn","green","dim","red","join","logError","msg","stopAndPersist","symbol","cyan","fail","ErrorWithHint","Error","constructor","message","hint","PACKAGES_TO_AUTO_DETECT_EXPORTS","path","detectExports","filePath","fileLoc","resolveFrom","fs","existsSync","keys","require","filter","e","err","resolveWebDependency","dep","isExplicit","extname","isJSFile","includes","type","loc","depManifestLoc","depManifest","foundEntrypoint","module","main","italic","underline","getWebDependencyName","replace","install","arrayOfDeps","isCleanInstall","destLoc","hasBrowserlistConfig","isStrict","isBabel","isOptimized","sourceMap","namedExports","remoteUrl","remotePackages","nodeModulesLoc","knownNamedExports","remotePackageMap","depList","Set","forEach","glob","hasMagic","add","sync","nodir","f","size","rimraf","depObject","assetObject","importMap","depName","depType","depLoc","push","text","length","inputOptions","input","plugins","rollupPluginReplace","name","resolveId","source","urlSourcePath","id","external","isExternal","load","rollupPluginNodeResolve","mainFields","Boolean","modulesOnly","extensions","preferBuiltins","rollupPluginJson","preferConst","indent","rollupPluginCommonjs","rollupPluginBabel","compact","babelrc","presets","babelPresetEnv","modules","targets","undefined","rollupPluginTerser","onwarn","warning","warn","code","importer","isNodeBuiltin","outputOptions","dir","format","sourcemap","exports","chunkFileNames","packageBundle","rollup","write","writeFileSync","JSON","stringify","imports","encoding","entries","assetName","assetLoc","mkdirp","dirname","copyFileSync","cli","args","help","babel","optimize","strict","clean","dest","remotePackage","yargs","resolve","exit","pkgManifest","webDependencies","doesWhitelistExist","dependencies","browserslist","env","BROWSERSLIST","start","startTime","Date","now","result","p","split","succeed","toFixed","exitCode"],"mappings":"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"}